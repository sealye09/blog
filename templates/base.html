<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>{{pageTitle}}</title>
    <script>
      (function () {
        try {
          var stored = localStorage.getItem("theme");
          var prefersDark =
            window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)").matches;
          var theme = stored ? stored : prefersDark ? "dark" : "light";
          document.documentElement.setAttribute("data-theme", theme);
        } catch (e) {}
      })();
    </script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap"
      rel="stylesheet"
    />
    {{cssLinks}}
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css"
      media="(prefers-color-scheme: light)"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css"
      media="(prefers-color-scheme: dark)"
    />
    <meta name="theme-color" content="#ffffff" />
  </head>
  <body>
    <header class="site-header">
      <div class="container header-inner">
        <a class="brand" href="{{basePath}}/index.html">{{siteTitle}}</a>
        <nav class="site-nav" aria-label="主导航">
          <a class="site-nav__link" href="{{basePath}}/index.html">首页</a>
          <a class="site-nav__link" href="{{basePath}}/archive.html">归档</a>
        </nav>
        <div class="header-actions">
          <a
            href="https://github.com/{{githubUsername}}"
            class="github-link"
            target="_blank"
            rel="noopener noreferrer"
            aria-label="GitHub"
            data-username="{{githubUsername}}"
          >
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
              <path
                d="M12 2C6.477 2 2 6.477 2 12c0 4.42 2.865 8.17 6.839 9.49.5.092.682-.217.682-.482 0-.237-.008-.866-.013-1.7-2.782.603-3.369-1.34-3.369-1.34-.454-1.156-1.11-1.463-1.11-1.463-.908-.62.069-.608.069-.608 1.003.07 1.531 1.03 1.531 1.03.892 1.529 2.341 1.087 2.91.831.092-.646.35-1.086.636-1.336-2.22-.253-4.555-1.11-4.555-4.943 0-1.091.39-1.984 1.029-2.683-.103-.253-.446-1.27.098-2.647 0 0 .84-.269 2.75 1.025A9.578 9.578 0 0112 6.836c.85.004 1.705.114 2.504.336 1.909-1.294 2.747-1.025 2.747-1.025.546 1.377.203 2.394.1 2.647.64.699 1.028 1.592 1.028 2.683 0 3.842-2.339 4.687-4.566 4.935.359.309.678.919.678 1.852 0 1.336-.012 2.415-.012 2.743 0 .267.18.578.688.48C19.138 20.167 22 16.418 22 12c0-5.523-4.477-10-10-10z"
              />
            </svg>
          </a>
          <button id="theme-toggle" class="theme-toggle" aria-label="切换主题">
            <!-- Sun icon -->
            <svg
              class="icon-sun"
              width="18"
              height="18"
              viewBox="0 0 24 24"
              fill="currentColor"
              aria-hidden="true"
            >
              <path d="M12 18a6 6 0 1 0 0-12 6 6 0 0 0 0 12Z" />
              <path
                d="M12 1v3M12 20v3M4.22 4.22l2.12 2.12M17.66 17.66l2.12 2.12M1 12h3M20 12h3M4.22 19.78l2.12-2.12M17.66 6.34l2.12-2.12"
                stroke="currentColor"
                stroke-width="1.5"
                fill="none"
                stroke-linecap="round"
              />
            </svg>
            <!-- Moon icon -->
            <svg
              class="icon-moon"
              width="18"
              height="18"
              viewBox="0 0 24 24"
              fill="currentColor"
              aria-hidden="true"
            >
              <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79Z" />
            </svg>
          </button>
        </div>
      </div>
    </header>
    <main class="site-main container">{{content}}</main>
    <footer class="site-footer">
      <div class="container">
        <p>Powered by GitHub Pages</p>
      </div>
    </footer>
    <script>
      (function () {
        var btn = document.getElementById("theme-toggle");
        if (!btn) return;
        function setTheme(theme) {
          document.documentElement.setAttribute("data-theme", theme);
          try {
            localStorage.setItem("theme", theme);
          } catch (e) {}
          var meta = document.querySelector('meta[name="theme-color"]');
          if (meta) {
            meta.setAttribute("content", theme === "dark" ? "#0a0a0a" : "#ffffff");
          }
        }
        function withNoTransitions(fn) {
          var root = document.documentElement;
          root.classList.add("disable-transitions");
          try {
            fn();
          } finally {
            setTimeout(function () {
              root.classList.remove("disable-transitions");
            }, 0);
          }
        }
        btn.addEventListener("click", function () {
          var current = document.documentElement.getAttribute("data-theme") || "light";
          var next = current === "light" ? "dark" : "light";
          withNoTransitions(function () {
            setTheme(next);
          });
        });
      })();
    </script>
    <script>
      (function () {
        var githubLink = document.querySelector(".github-link");
        if (githubLink && !githubLink.getAttribute("data-username")) {
          githubLink.style.display = "none";
        }
      })();
    </script>
    <script>
      (function () {
        var content = document.querySelector(".post-content");
        var toc = document.querySelector(".post-toc[data-toc]");
        if (!content || !toc) return;
        var container = toc.querySelector(".post-toc__body");
        var title = toc.querySelector(".post-toc__title");
        if (!container) return;

        // Support h1-h5
        var headings = Array.prototype.slice.call(content.querySelectorAll("h1, h2, h3, h4, h5"));
        if (!headings.length) {
          toc.style.display = "none";
          return;
        }

        function slugify(text) {
          return String(text || "")
            .trim()
            .toLowerCase()
            .replace(/[\s/\\]+/g, "-")
            .replace(/[^\p{Letter}\p{Number}\-_.]+/gu, "-")
            .replace(/-+/g, "-")
            .replace(/^-+|-+$/g, "");
        }

        headings.forEach(function (heading) {
          var title = (heading.textContent || "").trim();
          if (!title) return;
          if (!heading.id) {
            var slug = slugify(title);
            heading.id = slug || "section-" + Math.random().toString(36).slice(2, 8);
          }
          var level = heading.tagName.toLowerCase().replace("h", "");
          var link = document.createElement("a");
          link.href = "#" + heading.id;
          link.textContent = title;
          link.setAttribute("data-level", level);
          container.appendChild(link);
        });

        // Mobile collapse toggle
        var isMobile = window.innerWidth <= 1024;
        if (isMobile) {
          toc.setAttribute("data-collapsed", "true");
          if (title) {
            title.addEventListener("click", function () {
              var isCollapsed = toc.getAttribute("data-collapsed") === "true";
              toc.setAttribute("data-collapsed", isCollapsed ? "false" : "true");
            });
          }
        }

        // Active state tracking
        var links = container.querySelectorAll("a");
        var observer = new IntersectionObserver(
          function (entries) {
            entries.forEach(function (entry) {
              if (entry.isIntersecting) {
                var id = entry.target.id;
                links.forEach(function (link) {
                  link.classList.toggle("active", link.getAttribute("href") === "#" + id);
                });
              }
            });
          },
          { rootMargin: "-80px 0px -80% 0px" },
        );

        headings.forEach(function (h) {
          observer.observe(h);
        });

        // Smooth scroll
        links.forEach(function (link) {
          link.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").slice(1);
            var target = document.getElementById(id);
            if (target) {
              target.scrollIntoView({ behavior: "smooth", block: "start" });
              history.pushState(null, null, "#" + id);
            }
          });
        });
      })();
    </script>
  </body>
</html>
